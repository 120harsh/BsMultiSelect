{"version":3,"sources":["../src/BsMultiSelect.js"],"names":[],"mappings":"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","file":"BsMultiSelect.js","sourcesContent":["import {PluginManager, plugStaticDom} from './PluginManager'\r\n\r\nimport {composeSync} from './ToolsJs';\r\n\r\nimport {PickDomFactory} from './PickDomFactory';\r\nimport {ChoiceDomFactory} from './ChoiceDomFactory';\r\n\r\nimport {StaticDomFactory, CreateElementAspect} from './StaticDomFactory';\r\n\r\nimport {PicksDom} from './PicksDom';\r\nimport {FilterDom} from './FilterDom';\r\n\r\nimport {ChoicesDomFactory} from './ChoicesDomFactory';\r\nimport {PopupAspect} from './PopupAspect';\r\n\r\nimport {ComponentPropertiesAspect, TriggerAspect, OnChangeAspect} from './ComponentPropertiesAspect';\r\nimport {OptionsAspect, OptionPropertiesAspect} from './OptionsAspect';\r\n\r\nimport {DoublyLinkedCollection} from './ToolsJs'\r\n\r\nimport {FilterListAspect, ChoicesGetNextAspect, ChoicesEnumerableAspect } from './FilterListAspect'\r\nimport {ChoicesElementAspect, ChoiceFactoryAspect, ChoicesAspect } from './ChoicesAspect'\r\nimport {UpdateDataAspect } from './UpdateDataAspect'\r\n\r\nimport {OptionToggleAspect} from './OptionToggleAspect'\r\nimport {ChoiceAspect} from './ChoiceAspect.js'\r\nimport {Choices} from './Choices'\r\nimport {ChoicesHover} from './ChoicesHover'\r\nimport {Picks} from './Picks'\r\nimport {PicksAspect} from './PicksAspect'\r\nimport {InputAspect} from './InputAspect'\r\nimport {ResetFilterListAspect} from './ResetFilterListAspect'\r\nimport {ManageableResetFilterListAspect} from './ResetFilterListAspect'\r\nimport {FocusInAspect} from './ResetFilterListAspect'\r\nimport {MultiSelectInputAspect} from './MultiSelectInputAspect'\r\nimport {FilterAspect} from './FilterAspect'\r\nimport {DisabledComponentAspect, LoadAspect, AppearanceAspect} from './AppearanceAspect'\r\n\r\n/// environment - common for many; configuration for concreate\r\nexport function BsMultiSelect(element, environment, configuration, onInit){\r\n    var {Popper, window, plugins} = environment;\r\n    \r\n    if (typeof Popper === 'undefined') {\r\n        throw new Error(\"BsMultiSelect: Popper.js (https://popper.js.org) is required\")\r\n    }\r\n\r\n    let { containerClass,\r\n          css, \r\n          getDisabled,\r\n          options, \r\n          getText, getSelected, setSelected, getIsOptionDisabled,\r\n        } = configuration;\r\n\r\n    let disposeAspect = {};\r\n    let triggerAspect = TriggerAspect(element, environment.trigger);\r\n    let onChangeAspect = OnChangeAspect(triggerAspect, 'dashboardcode.multiselect:change');\r\n    let componentAspect = ComponentPropertiesAspect(getDisabled??(() => false));\r\n    let optionsAspect   = OptionsAspect(options); \r\n    let optionPropertiesAspect = OptionPropertiesAspect(getText, getSelected, setSelected, getIsOptionDisabled);\r\n    let choiceAspect        = ChoiceAspect(optionPropertiesAspect);\r\n    let optionToggleAspect  = OptionToggleAspect(choiceAspect);\r\n    let createElementAspect = CreateElementAspect(name => window.document.createElement(name));\r\n    let choicesDomFactory = ChoicesDomFactory(createElementAspect);\r\n    let staticDomFactory  = StaticDomFactory(choicesDomFactory, createElementAspect);\r\n    \r\n    let aspects = {\r\n        environment, configuration, triggerAspect, onChangeAspect, componentAspect, disposeAspect,\r\n        optionsAspect, optionPropertiesAspect, choiceAspect, optionToggleAspect, createElementAspect,\r\n        choicesDomFactory, staticDomFactory\r\n    }\r\n    \r\n    plugStaticDom(plugins, aspects); // apply cssPatch to css, apply selectElement support;  \r\n\r\n    let {choicesDom, createStaticDom} = staticDomFactory.create(css)\r\n\r\n    let {staticDom, staticManager} = createStaticDom(element, containerClass)\r\n\r\n    // after this we can use staticDom in construtctor, this simplifies parameter passing a lot   \r\n\r\n    let filterDom = FilterDom(staticDom.disposablePicksElement, createElementAspect, css);\r\n    // TODO get picksDom  from staticDomFactory\r\n    let picksDom  = PicksDom(staticDom.picksElement, staticDom.disposablePicksElement, createElementAspect, css);\r\n    let focusInAspect = FocusInAspect(picksDom)\r\n    let popupAspect = PopupAspect(choicesDom.choicesElement, filterDom.filterInputElement, Popper);\r\n\r\n    let collection = DoublyLinkedCollection(\r\n        (choice)=>choice.itemPrev, \r\n        (choice, v)=>choice.itemPrev=v, \r\n        (choice)=>choice.itemNext, \r\n        (choice, v)=>choice.itemNext=v, \r\n    );\r\n\r\n    let choicesGetNextAspect = ChoicesGetNextAspect(\r\n        ()=>collection.getHead(),\r\n        (choice)=>choice.itemNext\r\n    )\r\n\r\n    let choicesEnumerableAspect = ChoicesEnumerableAspect(\r\n        choicesGetNextAspect\r\n    )\r\n\r\n    let filterListAspect = FilterListAspect(choicesGetNextAspect, choicesEnumerableAspect); \r\n    let resetFilterListAspect = ResetFilterListAspect(filterDom, filterListAspect)\r\n    let manageableResetFilterListAspect =  ManageableResetFilterListAspect(filterDom, resetFilterListAspect)\r\n    // TODO move to fully index collection\r\n    let choices = Choices(\r\n        collection,\r\n        ()=>filterListAspect.reset(), \r\n        (c)=>filterListAspect.remove(c),\r\n        (c)=>filterListAspect.addFilterFacade(c), \r\n        (c)=>filterListAspect.insertFilterFacade(c));\r\n    \r\n    let choicesHover = ChoicesHover((down, hoveredChoice)=>filterListAspect.navigate(down, hoveredChoice));\r\n\r\n    let inputAspect = InputAspect(filterListAspect, choiceAspect, filterDom, popupAspect, choicesHover);\r\n\r\n    let picks = Picks();\r\n    \r\n    let pickDomFactory = PickDomFactory(css, componentAspect, optionPropertiesAspect);\r\n    let picksAspect = PicksAspect(\r\n        picksDom, \r\n        pickDomFactory,\r\n        choiceAspect, picks, manageableResetFilterListAspect\r\n    );\r\n\r\n    let choiceDomFactory = ChoiceDomFactory(css, optionPropertiesAspect);\r\n    \r\n    let choicesElementAspect = ChoicesElementAspect( choicesDom, filterDom, choiceDomFactory, onChangeAspect, optionToggleAspect, picksAspect)\r\n    let choiceFactoryAspect =  ChoiceFactoryAspect(choicesElementAspect, choicesGetNextAspect);\r\n    let choicesAspect = ChoicesAspect(window.document, choiceAspect, optionsAspect, choices, choiceFactoryAspect);\r\n\r\n    let multiSelectInputAspect =  MultiSelectInputAspect(\r\n        window,\r\n        () => filterDom.setFocus(), \r\n        picksDom.picksElement, \r\n        choicesDom.choicesElement, \r\n        () => popupAspect.isChoicesVisible(),\r\n        (visible) => popupAspect.setChoicesVisible(visible),\r\n        () => choicesHover.resetHoveredChoice(), \r\n        (choice) => choicesHover.hoverIn(choice),\r\n        () => manageableResetFilterListAspect.resetFilter(),\r\n        () => filterListAspect.getCount()==0, \r\n        \r\n        /*onClick*/(event) => filterDom.setFocusIfNotTarget(event.target),\r\n        /*resetFocus*/() => focusInAspect.setFocusIn(false),\r\n        /*alignToFilterInputItemLocation*/() => popupAspect.updatePopupLocation()\r\n    );\r\n\r\n    let disabledComponentAspect = DisabledComponentAspect(componentAspect, picks, multiSelectInputAspect, picksDom);\r\n    let appearanceAspect = AppearanceAspect(disabledComponentAspect);\r\n    let loadAspect = LoadAspect(choicesAspect, multiSelectInputAspect, appearanceAspect);\r\n\r\n    function hoveredToSelected(){\r\n        let hoveredChoice = choicesHover.getHoveredChoice();\r\n        if (hoveredChoice){\r\n            var wasToggled = optionToggleAspect.toggle(hoveredChoice);\r\n            if (wasToggled) {\r\n                multiSelectInputAspect.hideChoices();\r\n                manageableResetFilterListAspect.resetFilter();\r\n            }\r\n        }\r\n    }\r\n\r\n    function keyDownArrow(down) {\r\n        let choice = choicesHover.navigate(down);\r\n        if (choice)\r\n        {\r\n            choicesHover.hoverIn(choice);\r\n            multiSelectInputAspect.showChoices();\r\n        }\r\n    }\r\n\r\n    let filterAspect = FilterAspect(\r\n        filterDom.filterInputElement,\r\n        () => focusInAspect.setFocusIn(true),  // focus in - show dropdown\r\n        () => multiSelectInputAspect.onFocusOut(\r\n            () => focusInAspect.setFocusIn(false)\r\n        ), // focus out - hide dropdown\r\n        \r\n        () => keyDownArrow(false), // arrow up\r\n        () => keyDownArrow(true),  // arrow down\r\n        /*onTabForEmpty*/() => multiSelectInputAspect.hideChoices(),  // tab on empty\r\n        () => {\r\n            let p = picks.removePicksTail();\r\n            if (p)\r\n                popupAspect.updatePopupLocation();\r\n        }, // backspace - \"remove last\"\r\n\r\n        /*onTabToCompleate*/() => { \r\n            if (popupAspect.isChoicesVisible()) {\r\n                hoveredToSelected();\r\n            } \r\n        },\r\n        /*onEnterToCompleate*/() => { \r\n            if (popupAspect.isChoicesVisible()) {\r\n                hoveredToSelected();\r\n            } else {\r\n                if (filterListAspect.getCount()>0){\r\n                    multiSelectInputAspect.showChoices();\r\n                }\r\n            }\r\n        },\r\n       \r\n        /*onKeyUpEsc*/() => {\r\n            multiSelectInputAspect.hideChoices(); // always hide 1st\r\n            manageableResetFilterListAspect.resetFilter();\r\n        }, // esc keyup \r\n\r\n         // tab/enter \"compleate hovered\"\r\n        /*stopEscKeyDownPropogation */() => popupAspect.isChoicesVisible(),\r\n\r\n        /*onInput*/(filterInputValue, resetLength) =>\r\n        { \r\n            inputAspect.input(\r\n                filterInputValue, \r\n                resetLength,\r\n                ()=>multiSelectInputAspect.eventLoopFlag.set(), \r\n                ()=>multiSelectInputAspect.showChoices(),\r\n                ()=>multiSelectInputAspect.hideChoices()\r\n            ) \r\n        }\r\n    );\r\n\r\n    let updateDataAspect = UpdateDataAspect(multiSelectInputAspect, manageableResetFilterListAspect,\r\n        choicesDom, choices, picks, choicesAspect);\r\n\r\n    aspects.pickDomFactory=pickDomFactory;\r\n    aspects.choiceDomFactory=choiceDomFactory;\r\n    aspects.staticDom=staticDom;\r\n    aspects.picksDom=picksDom;\r\n    aspects.choicesDom=choicesDom;\r\n    aspects.popupAspect=popupAspect;\r\n    aspects.staticManager=staticManager;\r\n\r\n    aspects.choicesGetNextAspect=choicesGetNextAspect;\r\n    aspects.choicesEnumerableAspect=choicesEnumerableAspect;\r\n    aspects.filterListAspect=filterListAspect;\r\n    aspects.choices=choices;\r\n    aspects.choicesHover=choicesHover;\r\n    aspects.picks=picks;\r\n    aspects.choicesElementAspect=choicesElementAspect;\r\n    aspects.choiceFactoryAspect=choiceFactoryAspect;\r\n    aspects.choicesAspect=choicesAspect;\r\n\r\n    aspects.picksAspect=picksAspect;\r\n    aspects.filterDom=filterDom;\r\n    aspects.inputAspect=inputAspect;\r\n    aspects.resetFilterListAspect=resetFilterListAspect;\r\n    aspects.manageableResetFilterListAspect=manageableResetFilterListAspect;\r\n\r\n    aspects.multiSelectInputAspect=multiSelectInputAspect;\r\n    aspects.focusInAspect=focusInAspect;\r\n    aspects.filterAspect=filterAspect;\r\n    aspects.disabledComponentAspect=disabledComponentAspect;\r\n    aspects.appearanceAspect=appearanceAspect;\r\n\r\n    aspects.loadAspect=loadAspect;\r\n    aspects.updateDataAspect=updateDataAspect;\r\n\r\n    let pluginManager = PluginManager(plugins, aspects);\r\n        \r\n    let api = {component: \"BsMultiSelect.api\"} \r\n   \r\n    pluginManager.buildApi(api);\r\n\r\n    api.dispose = composeSync(\r\n        disposeAspect.dispose,\r\n        multiSelectInputAspect.hideChoices,\r\n        pluginManager.dispose, \r\n        picks.dispose,\r\n        multiSelectInputAspect.dispose,\r\n        choices.dispose,\r\n        staticManager.dispose, popupAspect.dispose, picksDom.dispose, filterDom.dispose, filterAspect.dispose );\r\n    \r\n    api.updateData = updateDataAspect.updateData;\r\n    api.update = () => {\r\n        updateDataAspect.updateData();\r\n        appearanceAspect.updateAppearance();\r\n    }\r\n    api.updateAppearance = appearanceAspect.updateAppearance\r\n    api.updateDisabled = disabledComponentAspect.updateDisabledComponent;\r\n\r\n    onInit?.(api, aspects);\r\n       \r\n    picksDom.pickFilterElement.appendChild(filterDom.filterInputElement);\r\n    picksDom.picksElement.appendChild(picksDom.pickFilterElement); \r\n    staticManager.appendToContainer();\r\n    popupAspect.init();\r\n    loadAspect.load();\r\n\r\n    return api;\r\n}\r\n"]}