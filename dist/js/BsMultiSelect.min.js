"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_popper=_interopRequireDefault(require("popper.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var BsMultiSelect=function(d,h,f){var e=h.fn[t],t="dashboardCodeBsMultiSelect",i="plugin_"+t,n={items:[],defaults:[],usePopper:!0,selectedPanelMinHeight:"calc(2.25rem + 2px)",selectedPanelReadonlyBackgroundColor:"#e9ecef",filterInputColor:"#495057",containerClass:"dashboardcode-bs-multiselect",dropDownMenuClass:"dropdown-menu",dropDownItemClass:"px-2",selectedPanelClass:"form-control btn border",selectedPanelStyle:{"min-height":"calc(2.25rem + 2px)"},selectedPanelStyleSys:{cursor:"text",display:"flex","flex-wrap":"wrap","align-items":"center","margin-bottom":"0px"},selectedPanelReadonlyStyle:{"background-color":"#e9ecef"},selectedItemClass:"badge",selectedItemStyle:{"padding-left":"0px"},selectedItemStyleSys:{display:"flex","align-items":"center"},removeSelectedItemButtonClass:"close",removeSelectedItemButtonStyle:{"font-size":"100%"},filterInputItemClass:"",filterInputItemStyle:{},filterInputItemStyleSys:{display:"block"},filterInputClass:"",filterInputStyle:{color:"#495057"},filterInputStyleSys:{width:"2ch",border:"0",padding:"0",outline:"none"}},s=function(){function o(e,t){if(_classCallCheck(this,o),"undefined"==typeof f)throw new TypeError("DashboardCode bsMultiSelect require Popper.js (https://popper.js.org)");this.element=e,this.options=h.extend({},n,t),this.input=e,this.container=null,this.dropDownMenu=null,this.selectedPanel=null,this.filterInput=null,this.filterInputItem=null,this.popper=null,this.skipFocusout=!1,this.backspaceAtStartPoint=null,this.selectedDropDownItem=null,this.selectedDropDownIndex=null,this.hasItems=!1,this.init()}return _createClass(o,[{key:"updateDropDownPosition",value:function(){this.options.usePopper?this.popper.update():h(this.dropDownMenu).dropdown("update")}},{key:"hideDropDown",value:function(){this.options.usePopper?h(this.dropDownMenu).removeClass("show"):h(this.dropDownMenu).hasClass("show")&&h(this.dropDownMenu).dropdown("toggle")}},{key:"showDropDown",value:function(){this.hasItems&&(this.options.usePopper?h(this.dropDownMenu).addClass("show"):h(this.dropDownMenu).hasClass("show")||h(this.dropDownMenu).dropdown("toggle"))}},{key:"setCheck",value:function(e,t){for(var o=0;o<this.input.options.length;o+=1){if(this.input.options[o].value==e){this.input.options[o].selected=t;break}}}},{key:"getInputValue",value:function(){return h(this.input).val()}},{key:"closeDropDown",value:function(){this.clearFilterInput(),this.hideDropDown(),this.updateDropDownPosition()}},{key:"clearFilterInput",value:function(){""!=this.filterInput.value&&(this.filterInput.value="",this.filterDropDownMenu(),this.hasItems&&this.updateDropDownPosition())}},{key:"filterDropDownMenu",value:function(){var o=this.filterInput.value.trim(),n=0;h(this.dropDownMenu).find("li").each(function(){var e=h(this);if(""==o)e.show(),n++;else{var t=e.text();!e.find('input[type="checkbox"]').prop("checked")&&t.toLowerCase().includes(o.toLowerCase())?(e.show(),n++):e.hide()}}),this.hasItems=0<n,this.resetSelectDropDownMenu()}},{key:"clickDropDownItem",value:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget.closest("LI"),o=h(t),n=o.data("option-id"),i=o.find('input[type="checkbox"]');if(i.prop("checked")){var s=h(this.selectedPanel).find('li[data-option-id="'.concat(n,'"]'));this.removeSelectedItem(s,n,i)}else{var r=o.find("label").text();this.createAndAppendSelectedItem(i,n,r),i.prop("checked",!0)}this.clearFilterInput(),h(this.filterInput).focus()}},{key:"appendDropDownItem",value:function(e,t,o){var n=e,i="dashboardcode-bs-multiselect-".concat(this.input.name.toLowerCase(),"-generated-id-").concat(n.toLowerCase()),s=o?"checked":"",r=h('<li data-option-id="'.concat(n,'">\n                    <div class="custom-control custom-checkbox">\n                        <input type="checkbox" class="custom-control-input" id="').concat(i,'" ').concat(s,'>\n                        <label class="custom-control-label" for="').concat(i,'">').concat(t,"</label>\n                    </div>\n                 </li>")).addClass(this.options.dropDownItemClass).appendTo(h(this.dropDownMenu)).find('input[type="checkbox"]');o&&this.createAndAppendSelectedItem(r,n,t)}},{key:"createAndAppendSelectedItem",value:function(t,o,e){var n=this,i=h('<li data-option-id="'.concat(o,'"><span>').concat(e,"</span></li>")).css(this.options.selectedItemStyleSys).css(this.options.selectedItemStyle).addClass(this.options.selectedItemClass).insertBefore(h(this.filterInputItem)),s=h("<button aria-label='Close' tabIndex='-1' type='button'><span aria-hidden='true'>&times;</span></button>").css(this.options.removeSelectedItemButtonStyle).addClass(this.options.removeSelectedItemButtonClass).appendTo(i);this.setCheck(o,!0),s.click(function(e){n.removeSelectedItem(i,o,t),n.updateDropDownPosition(),h(n.filterInput).focus()})}},{key:"adoptFilterInputLength",value:function(){this.filterInput.style.width=1.3*this.filterInput.value.length+2+"ch"}},{key:"analyzeInputText",value:function(){var t=this.filterInput.value.trim().toLowerCase(),e=_toConsumableArray(this.dropDownMenu.querySelectorAll("LI")).find(function(e){return e.textContent.trim().toLowerCase()==t});if(null!=e){var o=h(e),n=o.find('input[type="checkbox"]');if(!n.prop("checked")){var i=o.data("option-id"),s=o.find("label").text();this.createAndAppendSelectedItem(n,i,s),n.prop("checked",!0)}this.clearFilterInput()}}},{key:"resetSelectDropDownMenu",value:function(){null!=this.selectedDropDownItem&&(this.selectedDropDownItem.classList.remove("bg-light"),this.selectedDropDownItem.classList.remove("text-primary"),this.selectedDropDownItem=null),this.selectedDropDownIndex=null}},{key:"keydownArrow",value:function(e){var t=_toConsumableArray(this.dropDownMenu.querySelectorAll('LI:not([style*="display: none"]'));if(0<t.length){if(this.showDropDown(),null==this.selectedDropDownItem)this.selectedDropDownIndex=e?0:t.length-1;else if(this.selectedDropDownItem.classList.remove("bg-light"),this.selectedDropDownItem.classList.remove("text-primary"),e){var o=this.selectedDropDownIndex+1;this.selectedDropDownIndex=o<t.length?o:0}else{o=this.selectedDropDownIndex-1;this.selectedDropDownIndex=0<=o?o:t.length-1}this.selectedDropDownItem=t[this.selectedDropDownIndex],this.selectedDropDownItem.classList.add("text-primary"),this.selectedDropDownItem.classList.add("bg-light")}}},{key:"removeSelectedItem",value:function(e,t,o){e.remove(),this.setCheck(t,!1),o.prop("checked",!1)}},{key:"init",value:function(){var c=this,e=h(this.input);e.hide();var t=this.input.disabled,o=h("<div/>").addClass(this.options.containerClass).insertAfter(e);this.container=o.get(0);var n=h("<ul/>").addClass(this.options.selectedPanelClass).css(this.options.selectedPanelStyleSys).css(this.options.selectedPanelStyle).appendTo(o);this.selectedPanel=n.get(0);var i=h("<li/>").css(this.options.filterInputItemStyleSys).css(this.options.filterInputItemStyle).addClass(this.options.filterInputItemClass).appendTo(n);this.filterInputItem=i.get(0);var s=h('<input type="search" autocomplete="off">').css(this.options.filterInputStyleSys).css(this.options.filterInputStyle).addClass(this.options.filterInputClass).appendTo(i);this.filterInput=s.get(0);var r=h("<ul/>").appendTo(o);if(this.dropDownMenu=r.get(0),r.addClass(this.options.dropDownMenuClass),this.options.usePopper?this.popper=new f(this.filterInput,this.dropDownMenu,{placement:"bottom-start",modifiers:{flip:{behavior:["left","right"]}}}):(h(this.dropDownMenu).addClass("dropdown dropdown-menu"),h(this.dropDownMenu).data("",""),h(this.dropDownMenu).dropdown({placement:"bottom-start",flip:!1,reference:this.filterInput})),null==this.options.items)this.options.items.forEach(function(e){var t=e.value,o=e.text,n=e.isChecked;c.appendDropDownItem(t,o,n)}),this.hasItems=0<options.items.length;else{var l=e.find("option");l.each(function(e,t){var o=t.value,n=t.text,i=t.selected;c.appendDropDownItem(o,n,i)}),this.hasItems=0<l.length}if(t)this.filterInput.style.display="none",n.css(this.options.selectedPanelReadonlyStyle),n.find("button").prop("disabled",!0),n.addClass();else{var a=this.input.id,p=this.input.closest(".form-group");if(null!=p){var u=p.querySelector('label[for="'.concat(a,'"]'));h(u).attr("for")==this.input.id&&(this.filterInput.id="dashboardcode-bs-multiselect-generated-filter-id-"+this.input.id,u.setAttribute("for",this.filterInput.id))}this.updateDropDownPosition(),r.click(function(e){e.stopPropagation()}),r.find("li").click(function(e){c.clickDropDownItem(e)}),r.on("mouseover",function(e){c.resetSelectDropDownMenu()}),r.find("li").on("mouseover",function(e){e.target.closest("li").classList.add("text-primary"),e.target.closest("li").classList.add("bg-light")}),r.find("li").on("mouseout",function(e){e.target.closest("li").classList.remove("text-primary"),e.target.closest("li").classList.remove("bg-light")}),n.click(function(e){"INPUT"!=e.target.nodeName&&h(c.filterInput).val("").focus(),"BUTTON"==e.target.nodeName||"SPAN"==e.target.nodeName&&"BUTTON"==e.target.parentElement.nodeName||c.showDropDown()}),s.on("keydown",function(e){38==e.which||38==e.keyCode?(e.preventDefault(),c.keydownArrow(!1)):40==e.which||40==e.keyCode?(e.preventDefault(),c.keydownArrow(!0)):13==e.which||13==e.keyCode||9==e.which||9==e.keyCode?e.preventDefault():(8!=e.which&&8!=e.keyCode||(c.backspaceAtStartPoint=0==c.filterInput.selectionStart&&0==c.filterInput.selectionEnd),c.resetSelectDropDownMenu())}),s.on("keyup",function(e){if(13==e.which||13==e.keyCode||9==e.which||9==e.keyCode)if(null!=c.selectedDropDownItem){var t=(l=h(c.selectedDropDownItem)).find('input[type="checkbox"]'),o=l.data("option-id");if(t.prop("checked")){var n=h(c.selectedPanel).find('li[data-option-id="'.concat(o,'"]'));c.removeSelectedItem(n,o,t)}else{var i=l.find("label").text();c.createAndAppendSelectedItem(t,o,i),t.prop("checked",!0),c.filterInput.value=""}}else c.analyzeInputText();else if(8==e.which||8==e.keyCode){var s=c.filterInput.selectionStart;if(0==c.filterInput.selectionEnd&&0==s&&c.backspaceAtStartPoint){var r=_toConsumableArray(c.selectedPanel.querySelectorAll("LI"));if(2<=r.length){var l,a=r[r.length-2],p=(o=h(a).data("option-id"),_toConsumableArray(c.dropDownMenu.querySelectorAll("LI")).find(function(e){return e.dataset.optionId==o}));t=(l=h(p)).find('input[type="checkbox"]'),n=h(c.selectedPanel).find('li[data-option-id="'.concat(o,'"]'));c.removeSelectedItem(n,o,t)}}c.backspaceAtStartPoint=null}else 27!=e.which&&27!=e.keyCode||c.closeDropDown()}),s.on("input",function(e){c.adoptFilterInputLength(),c.filterDropDownMenu(),c.hasItems?(c.updateDropDownPosition(),c.showDropDown()):c.hideDropDown()}),s.focusin(function(e){h(c.selectedPanel).addClass("focus")}),s.focusout(function(e){c.skipFocusout||h(c.selectedPanel).removeClass("focus")}),o.mousedown(function(e){c.skipFocusout=!0}),h(d.document).mouseup(function(e){c.skipFocusout=!1,c.container===e.target||c.container.contains(e.target)||c.closeDropDown()})}}}]),o}(),o=function(n){return this.each(function(){var e=h(this).data(i);if(!e){if(/dispose|hide/.test(n))return;var t="object"===_typeof(n)?n:null;e=new s(this,t),h(this).data(i,e)}if("string"==typeof n){var o=n;if("undefined"==typeof e[o])throw new TypeError('No method named "'.concat(o,'"'));e[o]()}})};return h.fn[t]=o,h.fn[t.charAt(0).toUpperCase()+t.slice(1)]=function(e){return h(this).data("plugin_"+t)},h.fn[t].Constructor=s,h.fn[t].noConflict=function(){return h.fn[t]=e,o},s}(window,_jquery.default,_popper.default),_default=BsMultiSelect;exports.default=_default;
//# sourceMappingURL=BsMultiSelect.min.js.map