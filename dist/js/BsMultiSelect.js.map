{"version":3,"file":"BsMultiSelect.js","sources":["../../js/src/Bs4Commons.es8.js","../../js/src/Bs4AdapterCss.es8.js","../../js/src/Bs4Adapter.es8.js","../../js/src/BsMultiSelect.es8.js"],"sourcesContent":["class Bs4Commons {\r\n    \r\n    constructor(jQuery, hiddenSelect, dropDownItemHoverClass){\r\n        this.$=jQuery;\r\n        this.hiddenSelect=hiddenSelect;\r\n        this.dropDownItemHoverClass = dropDownItemHoverClass;\r\n    }\r\n\r\n    CreateDropDownItemContent(\r\n        $dropDownItem, optionId, itemText, isSelected,\r\n        containerClass, dropDownItemClass){\r\n        let checkBoxId = `${containerClass}-${this.hiddenSelect.name.toLowerCase()}-generated-id-${optionId.toLowerCase()}`;\r\n        let checked = isSelected ? \"checked\" : \"\";\r\n\r\n        let $dropDownItemContent= this.$(`<div class=\"custom-control custom-checkbox\">\r\n            <input type=\"checkbox\" class=\"custom-control-input\" id=\"${checkBoxId}\" ${checked}>\r\n            <label class=\"custom-control-label\" for=\"${checkBoxId}\">${itemText}</label>\r\n        </div>`)\r\n        $dropDownItemContent.appendTo($dropDownItem);\r\n        let $checkBox = $dropDownItem.find(`INPUT[type=\"checkbox\"]`);\r\n        let adoptDropDownItem = (isSelected) => {\r\n            $checkBox.prop('checked', isSelected);\r\n        }\r\n        $dropDownItem.addClass(dropDownItemClass)\r\n        return adoptDropDownItem;\r\n    }\r\n\r\n    CreateSelectedItemContent($selectedItem, itemText, removeSelectedItem,\r\n        selectedItemClass, removeSelectedItemButtonClass, disabled\r\n    ){\r\n        $selectedItem.addClass(selectedItemClass);\r\n        \r\n        this.$(`<span>${itemText}</span>`).appendTo($selectedItem);\r\n        let $button = this.$('<button aria-label=\"Close\" tabIndex=\"-1\" type=\"button\"><span aria-hidden=\"true\">&times;</span></button>')\r\n            .addClass(removeSelectedItemButtonClass)\r\n            .css(\"white-space\", \"nowrap\")\r\n            .on(\"click\", removeSelectedItem)\r\n            .appendTo($selectedItem)\r\n            .prop(\"disabled\", disabled)\r\n        return $button;\r\n    }\r\n\r\n    FilterClick(event){\r\n        return !(event.target.nodeName == \"BUTTON\" || (event.target.nodeName == \"SPAN\" && event.target.parentElement.nodeName == \"BUTTON\"))\r\n    }\r\n\r\n    Hover($dropDownItem, isHover){\r\n        if (isHover)\r\n            $dropDownItem.addClass(this.dropDownItemHoverClass);\r\n        else\r\n            $dropDownItem.removeClass(this.dropDownItemHoverClass);\r\n    }\r\n}\r\nexport default Bs4Commons;\r\n","import Bs4Commons from \"./Bs4Commons.es8\";\r\n\r\nclass Bs4AdapterCss {\r\n\r\n    constructor(jQuery, hiddenSelect, options) {\r\n        const defaults = {\r\n            containerClass: 'dashboardcode-bsmultiselect',\r\n            dropDownMenuClass: 'dropdown-menu',\r\n            dropDownItemClass: 'px-2',\r\n            dropDownItemHoverClass: 'text-primary bg-light',\r\n            selectedPanelClass: 'form-control',\r\n            selectedPanelFocusClass : 'focus',\r\n            selectedPanelReadonlyClass: 'disabled',\r\n            selectedItemClass: 'badge',\r\n            removeSelectedItemButtonClass: 'close',\r\n            filterInputItemClass: '',\r\n            filterInputClass: ''\r\n        };\r\n        this.options = jQuery.extend({}, defaults, options);\r\n        this.jQuery=jQuery;\r\n        this.hiddenSelect=hiddenSelect;\r\n        this.bs4Commons = new Bs4Commons(jQuery, hiddenSelect, this.options.dropDownItemHoverClass);\r\n\r\n    }\r\n\r\n    Init($container, $selectedPanel, $filterInputItem, $filterInput, $dropDownMenu){\r\n        $container.addClass(this.options.containerClass);\r\n        $selectedPanel.addClass(this.options.selectedPanelClass);\r\n\r\n        $dropDownMenu.addClass(this.options.dropDownMenuClass);\r\n        $filterInputItem.addClass(this.options.filterInputItemClass)\r\n        $filterInput.addClass(this.options.filterInputClass);\r\n\r\n        let inputId = this.hiddenSelect.id;\r\n        let $formGroup = this.jQuery(this.hiddenSelect).closest('.form-group');\r\n        \r\n        if ($formGroup.length == 1) {\r\n            let $label = $formGroup.find(`label[for=\"${inputId}\"]`);\r\n            let f = $label.attr('for');\r\n            let $filterInput = $selectedPanel.find('input');\r\n            if (f == this.hiddenSelect.id) {\r\n                let id = `${this.options.containerClass}-generated-filter-id-${this.hiddenSelect.id}`;\r\n                $filterInput.attr('id', id);\r\n                $label.attr('for', id);\r\n            }\r\n        }\r\n    }\r\n\r\n    UpdateIsValid($selectedPanel){\r\n        let $hiddenSelect = this.jQuery(this.hiddenSelect);\r\n        if ($hiddenSelect.hasClass(\"is-valid\")){\r\n            $selectedPanel.addClass(\"is-valid\");\r\n        }\r\n\r\n        if ($hiddenSelect.hasClass(\"is-invalid\")){\r\n            $selectedPanel.addClass(\"is-invalid\");\r\n        }\r\n    }\r\n\r\n    Enable($selectedPanel, isEnabled){\r\n        if(isEnabled){\r\n            $selectedPanel.removeClass(this.options.selectedPanelReadonlyClass);\r\n            $selectedPanel.find('BUTTON').prop(\"disabled\", false);\r\n        }\r\n        else{\r\n            $selectedPanel.addClass(this.options.selectedPanelReadonlyClass);\r\n            $selectedPanel.find('BUTTON').prop(\"disabled\", true);\r\n        }\r\n    }\r\n\r\n    CreateDropDownItemContent($dropDownItem, optionId, itemText, isSelected){\r\n        return this.bs4Commons.CreateDropDownItemContent($dropDownItem, optionId, itemText, isSelected, this.options.containerClass, this.options.dropDownItemClass);\r\n    }\r\n\r\n    CreateSelectedItemContent($selectedItem, itemText, removeSelectedItem, disabled){\r\n        this.bs4Commons.CreateSelectedItemContent($selectedItem, itemText, removeSelectedItem, this.options.selectedItemClass, this.options.removeSelectedItemButtonClass, disabled);\r\n    }\r\n\r\n    \r\n    Hover($dropDownItem, isHover){\r\n        this.bs4Commons.Hover($dropDownItem, isHover);\r\n    }\r\n\r\n    FilterClick(event){\r\n        return this.bs4Commons.FilterClick(event)\r\n    }\r\n\r\n    Focus($selectedPanel, isFocused){\r\n        if (isFocused){\r\n            $selectedPanel.addClass(this.options.selectedPanelFocusClass);\r\n        }else{\r\n            $selectedPanel.removeClass(this.options.selectedPanelFocusClass);\r\n        }\r\n    }\r\n}\r\n\r\nexport default Bs4AdapterCss;\r\n","import Bs4Commons from \"./Bs4Commons.es8\";\r\n//import styles from './../../scss/BsMutliSelect.scss'\r\n\r\nclass Bs4Adapter {\r\n\r\n    constructor(jQuery, hiddenSelect, options) {\r\n        const defaults = {\r\n            selectedPanelDefMinHeight: 'calc(2.25rem + 2px)',\r\n            selectedPanelLgMinHeight: 'calc(2.875rem + 2px)',\r\n            selectedPanelSmMinHeight: 'calc(1.8125rem + 2px)',\r\n            selectedPanelReadonlyBackgroundColor: '#e9ecef',\r\n            selectedPanelFocusBorderColor: '#80bdff',\r\n            selectedPanelFocusBoxShadow: '0 0 0 0.2rem rgba(0, 123, 255, 0.25)',\r\n            selectedPanelFocusValidBoxShadow: '0 0 0 0.2rem rgba(40, 167, 69, 0.25)',\r\n            selectedPanelFocusInvalidBoxShadow: '0 0 0 0.2rem rgba(220, 53, 69, 0.25)',\r\n            filterInputColor: '#495057'\r\n        };\r\n        this.options = jQuery.extend({}, defaults, options);\r\n        this.jQuery=jQuery;\r\n        this.hiddenSelect=hiddenSelect;\r\n\r\n        this.containerClass= 'dashboardcode-bsmultiselect';\r\n        this.dropDownMenuClass= 'dropdown-menu';\r\n        this.dropDownItemClass= 'px-2';\r\n        this.dropDownItemHoverClass= 'text-primary bg-light';\r\n        this.selectedPanelClass= 'form-control';\r\n        this.selectedItemClass= 'badge';\r\n        this.removeSelectedItemButtonClass= 'close';\r\n\r\n        this.selectedPanelStyle= {'margin-bottom': '0'};\r\n        this.selectedItemStyle= {'padding-left': '0px', 'line-height': '1.5em'};\r\n        this.removeSelectedItemButtonStyle= {'font-size':'1.5em', 'line-height': '.9em'};\r\n\r\n        this.bs4Commons = new Bs4Commons(jQuery, hiddenSelect, this.dropDownItemHoverClass);\r\n    }\r\n\r\n    Init($container, $selectedPanel, $filterInputItem, $filterInput, $dropDownMenu){\r\n\r\n        $container.addClass(this.containerClass);\r\n        $selectedPanel.addClass(this.selectedPanelClass);\r\n        $selectedPanel.css(this.selectedPanelStyle);\r\n\r\n        $dropDownMenu.addClass(this.dropDownMenuClass);\r\n        $filterInput.css(\"color\", this.options.filterInputColor);\r\n\r\n        let inputId = this.hiddenSelect.id;\r\n        let $formGroup = this.jQuery(this.hiddenSelect).closest('.form-group');\r\n        \r\n        if ($formGroup.length == 1) {\r\n            let $label = $formGroup.find(`label[for=\"${inputId}\"]`);\r\n            let f = $label.attr('for');\r\n            let $filterInput = $selectedPanel.find('input');\r\n            if (f == this.hiddenSelect.id) {\r\n                let id = `${this.containerClass}-generated-filter-id-${this.hiddenSelect.id}`;\r\n                $filterInput.attr('id', id);\r\n                $label.attr('for', id);\r\n            }\r\n        }\r\n    }\r\n\r\n    UpdateIsValid($selectedPanel){\r\n        let $hiddenSelect = this.jQuery(this.hiddenSelect);\r\n        if ($hiddenSelect.hasClass(\"is-valid\")){\r\n            $selectedPanel.addClass(\"is-valid\");\r\n        }\r\n\r\n        if ($hiddenSelect.hasClass(\"is-invalid\")){\r\n            $selectedPanel.addClass(\"is-invalid\");\r\n        }\r\n    }\r\n\r\n    UpdateSize($selectedPanel){\r\n        if ($selectedPanel.hasClass(\"form-control-lg\")){\r\n            $selectedPanel.css(\"min-height\", this.options.selectedPanelLgMinHeight);\r\n        } else if ($selectedPanel.hasClass(\"form-control-sm\")){\r\n            $selectedPanel.css(\"min-height\", this.options.selectedPanelSmMinHeight);\r\n        } else {\r\n            $selectedPanel.css(\"min-height\", this.options.selectedPanelDefMinHeight);\r\n        }\r\n    }\r\n\r\n    Enable($selectedPanel, isEnabled){\r\n        if(isEnabled){\r\n            $selectedPanel.css({\"background-color\": \"\"});\r\n            $selectedPanel.find('BUTTON').prop(\"disabled\", false);\r\n        }\r\n        else{\r\n            $selectedPanel.css({\"background-color\": this.options.selectedPanelReadonlyBackgroundColor});\r\n            $selectedPanel.find('BUTTON').prop(\"disabled\", true);\r\n        }\r\n    }\r\n\r\n    CreateDropDownItemContent($dropDownItem, optionId, itemText, isSelected){\r\n        return this.bs4Commons.CreateDropDownItemContent($dropDownItem, optionId, itemText, isSelected, this.containerClass, this.dropDownItemClass)\r\n    }\r\n\r\n    CreateSelectedItemContent($selectedItem, itemText, removeSelectedItem, disabled){\r\n        let $buttom = this.bs4Commons.CreateSelectedItemContent($selectedItem, itemText, removeSelectedItem, this.selectedItemClass, this.removeSelectedItemButtonClass, disabled);\r\n        $buttom.css(this.removeSelectedItemButtonStyle);\r\n        $selectedItem.css(this.selectedItemStyle);\r\n    }\r\n\r\n    Hover($dropDownItem, isHover){\r\n        this.bs4Commons.Hover($dropDownItem, isHover);\r\n    }\r\n\r\n    FilterClick(event){\r\n        return this.bs4Commons.FilterClick(event)\r\n    }\r\n\r\n    Focus($selectedPanel, isFocused){\r\n        if (isFocused){\r\n                if ($selectedPanel.hasClass(\"is-valid\")){\r\n                    $selectedPanel.css(\"box-shadow\", this.options.selectedPanelFocusValidBoxShadow);\r\n                } else if ($selectedPanel.hasClass(\"is-invalid\")){\r\n                    $selectedPanel.css(\"box-shadow\", this.options.selectedPanelFocusInvalidBoxShadow);\r\n                } else {\r\n                    $selectedPanel\r\n                        .css(\"box-shadow\", this.options.selectedPanelFocusBoxShadow)\r\n                        .css(\"border-color\", this.options.selectedPanelFocusBorderColor);\r\n                }\r\n        }else{\r\n            $selectedPanel.css(\"box-shadow\", \"\" ).css(\"border-color\", \"\")\r\n        }\r\n    }\r\n}\r\n\r\nexport default Bs4Adapter;\r\n","import $ from 'jquery'\r\nimport Popper from 'popper.js'\r\nimport Bs4AdapterCss from './Bs4AdapterCss.es8'\r\nimport Bs4Adapter from './Bs4Adapter.es8'\r\n\r\n// TODO: try to find convinient way to declare private members. Is it convinient enough to move them into IIFE?\r\nconst BsMultiSelect = ((window, $, Popper) => {\r\n    const JQUERY_NO_CONFLICT = $.fn[pluginName];\r\n    const pluginName = 'dashboardCodeBsMultiSelect';\r\n    const dataKey = `${pluginName}`;\r\n\r\n    const defSelectedPanelStyleSys = {'display':'flex', 'flex-wrap':'wrap', 'list-style-type':'none'};  // remove bullets since this is ul\r\n    const defFilterInputStyleSys   = {'width':'2ch', 'border':'0', 'padding':'0', 'outline':'none', 'background-color':'transparent' };\r\n    const defDropDownMenuStyleSys  = {'list-style-type':'none'}; // remove bullets since this is ul\r\n\r\n    const defaults = {\r\n        doManageFocus:true,\r\n        useCss:false,\r\n        adapter:null\r\n    }\r\n\r\n    class Plugin {\r\n        constructor(selectElement, options, adapter) {\r\n            if (typeof Popper === 'undefined') {\r\n                throw new TypeError('DashboardCode BsMultiSelect require Popper.js (https://popper.js.org)')\r\n            }\r\n\r\n            // readonly\r\n            this.selectElement = selectElement;\r\n            this.options = $.extend({}, defaults, options);\r\n\r\n            if (adapter)\r\n                this.adapter = adapter;\r\n            else\r\n                this.adapter = this.options.useCss?new Bs4AdapterCss($, this.selectElement, this.options):new Bs4Adapter($, this.selectElement, this.options);\r\n            \r\n            this.container = null;\r\n            this.selectedPanel = null;\r\n            this.filterInputItem = null;\r\n            this.filterInput = null;\r\n            this.dropDownMenu = null;\r\n            this.popper = null;\r\n\r\n            // removable handlers\r\n            this.selectedPanelClick  = null;\r\n            this.documentMouseup   = null;\r\n            this.containerMousedown   = null;\r\n            this.documentMouseup2   = null;\r\n\r\n            // state\r\n            this.disabled=null;\r\n            this.filterInputItemOffsetLeft = null; // used to detect changes in input field position (by comparision with current value)\r\n            this.skipFocusout = false;\r\n            this.hoveredDropDownItem = null;\r\n            this.hoveredDropDownIndex = null;\r\n            this.hasDropDownVisible = false;\r\n            this.init();\r\n        }\r\n\r\n        updateDropDownPosition(force) {\r\n            let offsetLeft = this.filterInputItem.offsetLeft;\r\n            if (force || this.filterInputItemOffsetLeft!=offsetLeft){\r\n                this.popper.update();\r\n                this.filterInputItemOffsetLeft=offsetLeft;\r\n            }\r\n        }\r\n\r\n        hideDropDown() {\r\n            this.dropDownMenu.style.display = 'none';\r\n        }\r\n\r\n        showDropDown() {\r\n            this.dropDownMenu.style.display = 'block';\r\n        }\r\n\r\n        // Public methods\r\n        resetDropDownMenuHover() {\r\n            if (this.hoveredDropDownItem !== null) {\r\n                this.adapter.Hover($(this.hoveredDropDownItem), false);\r\n                this.hoveredDropDownItem = null;\r\n            }\r\n            this.hoveredDropDownIndex = null;\r\n        }\r\n\r\n        filterDropDownMenu() {\r\n            let text = this.filterInput.value.trim().toLowerCase();\r\n            let visible = 0;\r\n            $(this.dropDownMenu).find('LI').each((i, dropDownMenuItem) => {\r\n                let $dropDownMenuItem = $(dropDownMenuItem);\r\n                if (text == '') {\r\n                    $dropDownMenuItem.show();\r\n                    visible++;\r\n                }\r\n                else {\r\n                    let itemText = $dropDownMenuItem.data(\"option-text\");\r\n                    let isSelected = $dropDownMenuItem.data(\"option-selected\");\r\n                    if (!isSelected && itemText.indexOf(text)>=0) {\r\n                        $dropDownMenuItem.show();\r\n                        visible++;\r\n                    } else {\r\n                        $dropDownMenuItem.hide();\r\n                    }\r\n                }\r\n            });\r\n            this.hasDropDownVisible = visible > 0;\r\n            this.resetDropDownMenuHover();\r\n        }\r\n\r\n        clearFilterInput(updatePosition) {\r\n            if (this.filterInput.value) {\r\n                this.filterInput.value = '';\r\n                this.input(updatePosition);\r\n            }\r\n        }\r\n\r\n        closeDropDown() {\r\n            this.resetDropDownMenuHover();\r\n            this.clearFilterInput(true);\r\n            this.hideDropDown();\r\n        }\r\n\r\n        appendDropDownItem(optionElement) {\r\n            let optionId = optionElement.value;\r\n            let itemText = optionElement.text;\r\n            let isSelected = optionElement.selected;\r\n            let $dropDownItem = $(\"<LI/>\");\r\n            $dropDownItem.data(\"option-id\", optionId);\r\n            $dropDownItem.data(\"option-text\", itemText.toLowerCase());\r\n\r\n            let adoptDropDownItem = this.adapter.CreateDropDownItemContent($dropDownItem, optionId, itemText, isSelected)\r\n            $dropDownItem.appendTo(this.dropDownMenu);\r\n\r\n            let appendItem = (doTrigger) => {\r\n                $dropDownItem.data(\"option-selected\", true);\r\n                let $selectedItem = $(\"<LI/>\");\r\n                $selectedItem.data(\"option-id\", optionId);\r\n                optionElement.selected = true;\r\n                adoptDropDownItem(true);\r\n\r\n                let removeItem = () => {\r\n                    $dropDownItem.data(\"option-selected\", false);\r\n                    $dropDownItem.data(\"option-toggle\", appendItem);\r\n                    $selectedItem.data(\"option-remove\", null);\r\n                    $selectedItem.remove();\r\n                    optionElement.selected = false;\r\n                    adoptDropDownItem(false);\r\n                    $(this.selectElement).trigger('change');\r\n                };\r\n                let removeItemAndCloseDropDown = () => {\r\n                    removeItem();\r\n                    this.closeDropDown();\r\n                };\r\n                this.adapter.CreateSelectedItemContent(\r\n                    $selectedItem,\r\n                    itemText,\r\n                    removeItemAndCloseDropDown,\r\n                    this.disabled\r\n                );\r\n                $selectedItem.insertBefore(this.filterInputItem);\r\n                $dropDownItem.data(\"option-toggle\", removeItem);\r\n                $selectedItem.data(\"option-remove\", removeItemAndCloseDropDown);\r\n                if (typeof doTrigger === \"undefined\" || doTrigger===true)\r\n                     $(this.selectElement).trigger('change');\r\n                return $selectedItem;\r\n            }\r\n            $dropDownItem.data(\"option-toggle\", appendItem );\r\n            \r\n            if (isSelected) {\r\n                appendItem(false);\r\n            }\r\n            let manageHover = (event, isOn) => {\r\n                this.adapter.Hover($(event.target).closest(\"LI\"), isOn)\r\n            }\r\n            $dropDownItem.click(event => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                let toggleItem = $(event.currentTarget).closest(\"LI\").data(\"option-toggle\");\r\n                toggleItem();\r\n                this.filterInput.focus();\r\n            }).mouseover(e => manageHover(e, true)).mouseout(e => manageHover(e, false));\r\n        }\r\n\r\n        keydownArrow(down) {\r\n            let visibleNodeListArray = $(this.dropDownMenu).find('LI:not([style*=\"display: none\"])').toArray();\r\n            if (visibleNodeListArray.length > 0) {\r\n                if (this.hasDropDownVisible) {\r\n                    this.updateDropDownPosition(true);\r\n                    this.showDropDown();\r\n                }\r\n                if (this.hoveredDropDownItem === null) {\r\n                    this.hoveredDropDownIndex = down ? 0 : visibleNodeListArray.length - 1;\r\n                }\r\n                else {\r\n                    this.adapter.Hover($(this.hoveredDropDownItem), false);\r\n                    if (down) {\r\n                        let newIndex = this.hoveredDropDownIndex + 1;\r\n                        this.hoveredDropDownIndex = newIndex < visibleNodeListArray.length ? newIndex : 0;\r\n                    } else {\r\n                        let newIndex = this.hoveredDropDownIndex - 1;\r\n                        this.hoveredDropDownIndex = newIndex >= 0 ? newIndex : visibleNodeListArray.length - 1;\r\n                    }\r\n                }\r\n                this.hoveredDropDownItem = visibleNodeListArray[this.hoveredDropDownIndex];\r\n                this.adapter.Hover($(this.hoveredDropDownItem), true);\r\n            }\r\n        }\r\n\r\n        input(forceUpdatePosition) {\r\n            this.filterInput.style.width = this.filterInput.value.length*1.3 + 2 + \"ch\";\r\n            this.filterDropDownMenu();\r\n            if (this.hasDropDownVisible) {\r\n                if (forceUpdatePosition) // ignore it if it is called from\r\n                    this.updateDropDownPosition(forceUpdatePosition); // we need it to support case when textbox changes its place because of line break (texbox grow with each key press)\r\n                this.showDropDown();\r\n            } else {\r\n                this.hideDropDown();\r\n            }\r\n        }\r\n\r\n        Update(){\r\n            let $selectedPanel = (this.selectedPanel);\r\n            this.adapter.UpdateIsValid($selectedPanel);\r\n            this.UpdateSizeImpl($selectedPanel);\r\n            this.UpdateReadonlyImpl($(this.container), $selectedPanel);\r\n        }\r\n\r\n        Dispose(){\r\n            $.removeData(this.selectElement, dataKey);\r\n            $(this.selectElement).off(dataKey)\r\n\r\n            if (this.adapter !== null) {\r\n                //this.adapter.destroy()\r\n                this.adapter = null\r\n            }\r\n\r\n            if (this.popper !== null) {\r\n                this.popper.destroy()\r\n                this.popper = null\r\n            }\r\n            \r\n            if (this.container !== null)\r\n            {\r\n                $(this.container).remove();\r\n                this.container = null;\r\n            }\r\n            \r\n            \r\n            this.selectedPanel = null;\r\n            this.filterInputItem = null;\r\n            this.filterInput = null;\r\n            this.dropDownMenu = null;\r\n            \r\n            //this.selectElement = null;\r\n            //this.options = null;\r\n            \r\n            // removable handlers\r\n            $(window.document).unbind(\"mouseup\", this.documentMouseup);\r\n            //$(window.document).unbind(\"mousedown\", this.containerMousedown);\r\n            $(window.document).unbind(\"mouseup\", this.documentMouseup2);\r\n            //this.selectedPanelClick  = null;\r\n        }\r\n\r\n        UpdateSize(){\r\n            this.UpdateSizeImpl($(this.selectedPanel));\r\n        }\r\n\r\n        UpdateReadonly(){\r\n            this.UpdateReadonlyImpl($(this.container), $(this.selectedPanel));\r\n        }\r\n\r\n        UpdateSizeImpl($selectedPanel){\r\n            if (this.adapter.UpdateSize)\r\n                this.adapter.UpdateSize($selectedPanel);\r\n        }\r\n\r\n        UpdateReadonlyImpl($container, $selectedPanel){\r\n            let disabled = this.selectElement.disabled;\r\n            if (this.disabled!==disabled){\r\n                if (disabled) {\r\n                    this.filterInput.style.display = \"none\";\r\n                    this.adapter.Enable($selectedPanel, false);\r\n\r\n                    if (this.options.doManageFocus){\r\n                        $container.unbind(\"mousedown\", this.containerMousedown);\r\n                        $(window.document).unbind(\"mouseup\", this.documentMouseup);\r\n                    }\r\n                    $selectedPanel.unbind(\"click\", this.selectedPanelClick);\r\n                    $(window.document).unbind(\"mouseup\", this.documentMouseup2);\r\n                    \r\n                } else {\r\n                    this.filterInput.style.display = \"inline-block\";\r\n                    this.adapter.Enable($selectedPanel, true);\r\n\r\n                    if (this.options.doManageFocus) {\r\n                        $container.mousedown(this.containerMousedown);    // removable\r\n                        $(window.document).mouseup(this.documentMouseup); // removable\r\n                    }\r\n                    $selectedPanel.click(this.selectedPanelClick);     // removable\r\n                    $(window.document).mouseup(this.documentMouseup2); // removable\r\n                }\r\n                this.disabled=disabled;\r\n            }\r\n        }\r\n\r\n        init() {\r\n            let $hiddenSelect = $(this.selectElement);\r\n            $hiddenSelect.hide();\r\n\r\n            let $container = $(\"<DIV/>\");\r\n            this.container = $container.get(0);\r\n\r\n            let $selectedPanel = $(\"<UL/>\");\r\n            $selectedPanel.css(defSelectedPanelStyleSys);\r\n            \r\n            this.selectedPanel = $selectedPanel.get(0);\r\n            \r\n            $selectedPanel.appendTo(this.container);\r\n\r\n            let $filterInputItem = $('<LI/>');\r\n            this.filterInputItem = $filterInputItem.get(0)\r\n\r\n            $filterInputItem.appendTo(this.selectedPanel);\r\n\r\n            let $filterInput = $('<INPUT type=\"search\" autocomplete=\"off\">');\r\n            $filterInput.css(defFilterInputStyleSys);\r\n            $filterInput.appendTo(this.filterInputItem);\r\n            this.filterInput = $filterInput.get(0);\r\n\r\n            let $dropDownMenu = $(\"<UL/>\")\r\n                .css({\"display\":\"none\"})\r\n                .appendTo($container);\r\n            this.dropDownMenu = $dropDownMenu.get(0);\r\n            \r\n            // prevent heavy understandable styling error\r\n            $dropDownMenu.css(defDropDownMenuStyleSys);\r\n\r\n            // create handlers\r\n            this.documentMouseup = () => {\r\n                console.log(\"skipFocusout = false\");\r\n                this.skipFocusout = false;\r\n            }\r\n    \r\n            this.containerMousedown = () => {\r\n                console.log(\"skipFocusout = true\");\r\n                this.skipFocusout = true;\r\n            };\r\n\r\n            this.documentMouseup2 = event => {\r\n                if (!(this.container === event.target || $.contains(this.container, event.target))) {\r\n                    this.closeDropDown();\r\n                }\r\n            }\r\n\r\n            this.selectedPanelClick = event => {\r\n                if (event.target.nodeName != \"INPUT\")\r\n                    $(this.filterInput).val('').focus();\r\n                if (this.hasDropDownVisible && this.adapter.FilterClick(event)){\r\n                    this.updateDropDownPosition(true);\r\n                    this.showDropDown();\r\n                }\r\n            };\r\n\r\n            this.adapter.Init($container, $selectedPanel, $filterInputItem, $filterInput, $dropDownMenu);\r\n            $container.insertAfter($hiddenSelect);\r\n            \r\n            this.popper = new Popper(this.filterInput, this.dropDownMenu, {\r\n                placement: 'bottom-start',\r\n                modifiers: {\r\n                    preventOverflow: {enabled:false},\r\n                    hide: {enabled:false},\r\n                    flip: { enabled:false }\r\n                    }\r\n            });\r\n            this.adapter.UpdateIsValid($selectedPanel);\r\n            this.UpdateSizeImpl($selectedPanel);\r\n            this.UpdateReadonlyImpl($container, $selectedPanel);\r\n\r\n            // some browsers (IE11) can change select value (as part of \"autocomplete\") after page is loaded but before \"ready\" event\r\n            $(document).ready(() => {\r\n                let selectOptions = $hiddenSelect.find('OPTION');\r\n                selectOptions.each(\r\n                    (index, optionElement) => {\r\n                        this.appendDropDownItem(optionElement);\r\n                    }\r\n                );\r\n                this.hasDropDownVisible = selectOptions.length > 0;\r\n                this.updateDropDownPosition(false);\r\n            });\r\n\r\n            $dropDownMenu.click( event => event.stopPropagation());\r\n\r\n            $dropDownMenu.mouseover(() => this.resetDropDownMenuHover());\r\n\r\n            if (this.options.doManageFocus)\r\n            {\r\n                $filterInput.focusin(() => this.adapter.Focus($selectedPanel, true))\r\n                            .focusout(() => {\r\n                                console.log(\"focusout \" + this.skipFocusout);\r\n                                if (!this.skipFocusout)\r\n                                    this.adapter.Focus($selectedPanel, false)\r\n                                });\r\n            }\r\n\r\n            $filterInput.on(\"keydown\", (event) => {\r\n                if (event.which == 38) {\r\n                    event.preventDefault();\r\n                    this.keydownArrow(false);\r\n                }\r\n                else if (event.which == 40) {\r\n                    event.preventDefault()\r\n                    this.keydownArrow(true);\r\n                }\r\n                else if (event.which == 13) {\r\n                    event.preventDefault();\r\n                }\r\n                else if (event.which == 9) {\r\n                    if (this.filterInput.value) {\r\n                        event.preventDefault();\r\n                    }\r\n                    else {\r\n                        this.closeDropDown();\r\n                    }\r\n                }\r\n                else {\r\n                    if (event.which == 8) {\r\n                        // NOTE: this will process backspace only if there are no text in the input field\r\n                        // If user will find this inconvinient, we will need to calculate something like this\r\n                        // this.isBackspaceAtStartPoint = (this.filterInput.selectionStart == 0 && this.filterInput.selectionEnd == 0);\r\n                        if (!this.filterInput.value)\r\n                        {\r\n                            let $penult = $(this.selectedPanel).find(\"LI:last\").prev();\r\n                            if ($penult.length){\r\n                                let removeItem = $penult.data(\"option-remove\");\r\n                                removeItem();\r\n                            }\r\n                            this.updateDropDownPosition(false);\r\n                        }\r\n                    }\r\n                    this.resetDropDownMenuHover();\r\n                }\r\n            });\r\n\r\n            $filterInput.on(\"keyup\", (event) => {\r\n                if (event.which == 13 || event.which == 9 ) {\r\n                    if (this.hoveredDropDownItem) {\r\n                        let $hoveredDropDownItem = $(this.hoveredDropDownItem);\r\n                        let toggleItem =  $hoveredDropDownItem.data(\"option-toggle\");\r\n                        toggleItem();\r\n                        this.closeDropDown();\r\n                    } else {\r\n                        let text = this.filterInput.value.trim().toLowerCase();\r\n                        let dropDownItems = this.dropDownMenu.querySelectorAll(\"LI\");\r\n                        let dropDownItem = null;\r\n                        for (let i = 0; i < dropDownItems.length; ++i) {\r\n                            let it = dropDownItems[i];\r\n                            if (it.textContent.trim().toLowerCase() == text)\r\n                            {\r\n                                dropDownItem=it;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (dropDownItem) {\r\n                            let $dropDownItem = $(dropDownItem);\r\n                            let isSelected = $dropDownItem.data(\"option-selected\");\r\n                            if (!isSelected){\r\n                                let toggle = $dropDownItem.data(\"option-toggle\");\r\n                                toggle();\r\n                            }\r\n                            this.clearFilterInput(true);\r\n                        }\r\n                    }\r\n                }\r\n                else if (event.which == 27) { // escape\r\n                    this.closeDropDown();\r\n                }\r\n            });\r\n\r\n            $filterInput.on('input', () => {\r\n                this.input(true);\r\n            });\r\n        }\r\n    }\r\n\r\n    function jQueryInterface(options) {\r\n        return this.each(function () {\r\n            let data = $(this).data(dataKey)\r\n\r\n            if (!data) {\r\n                if (/Dispose/.test(options)) {\r\n                    return;\r\n                }\r\n                const optionsObject = (typeof options === 'object')?options:null;\r\n                data = new Plugin(this, optionsObject);\r\n                $(this).data(dataKey, data);\r\n            }\r\n\r\n            if (typeof options === 'string') {\r\n                let methodName = options;\r\n                if (typeof data[methodName] === 'undefined') {\r\n                    throw new TypeError(`No method named \"${methodName}\"`)\r\n                }\r\n                data[methodName]()\r\n            }\r\n        })\r\n    }\r\n\r\n    $.fn[pluginName] = jQueryInterface;\r\n\r\n    // pluginName with first capitalized letter - return plugin instance for 1st $selected item\r\n    $.fn[pluginName.charAt(0).toUpperCase() + pluginName.slice(1)] = function () {\r\n        return $(this).data(dataKey);\r\n    };\r\n\r\n    $.fn[pluginName].Constructor = Plugin;\r\n\r\n    $.fn[pluginName].noConflict = function () {\r\n        $.fn[pluginName] = JQUERY_NO_CONFLICT\r\n        return jQueryInterface;\r\n    }\r\n    return Plugin;\r\n})(window, $, Popper);\r\n\r\nexport default BsMultiSelect;\r\n"],"names":["Bs4Commons","jQuery","hiddenSelect","dropDownItemHoverClass","$","CreateDropDownItemContent","$dropDownItem","optionId","itemText","isSelected","containerClass","dropDownItemClass","checkBoxId","name","toLowerCase","checked","$dropDownItemContent","appendTo","$checkBox","find","adoptDropDownItem","prop","addClass","CreateSelectedItemContent","$selectedItem","removeSelectedItem","selectedItemClass","removeSelectedItemButtonClass","disabled","$button","css","on","FilterClick","event","target","nodeName","parentElement","Hover","isHover","removeClass","Bs4AdapterCss","options","defaults","dropDownMenuClass","selectedPanelClass","selectedPanelFocusClass","selectedPanelReadonlyClass","filterInputItemClass","filterInputClass","extend","bs4Commons","Init","$container","$selectedPanel","$filterInputItem","$filterInput","$dropDownMenu","inputId","id","$formGroup","closest","length","$label","f","attr","UpdateIsValid","$hiddenSelect","hasClass","Enable","isEnabled","Focus","isFocused","Bs4Adapter","selectedPanelDefMinHeight","selectedPanelLgMinHeight","selectedPanelSmMinHeight","selectedPanelReadonlyBackgroundColor","selectedPanelFocusBorderColor","selectedPanelFocusBoxShadow","selectedPanelFocusValidBoxShadow","selectedPanelFocusInvalidBoxShadow","filterInputColor","selectedPanelStyle","selectedItemStyle","removeSelectedItemButtonStyle","UpdateSize","$buttom","BsMultiSelect","window","Popper","JQUERY_NO_CONFLICT","fn","pluginName","dataKey","defSelectedPanelStyleSys","defFilterInputStyleSys","defDropDownMenuStyleSys","doManageFocus","useCss","adapter","Plugin","selectElement","TypeError","container","selectedPanel","filterInputItem","filterInput","dropDownMenu","popper","selectedPanelClick","documentMouseup","containerMousedown","documentMouseup2","filterInputItemOffsetLeft","skipFocusout","hoveredDropDownItem","hoveredDropDownIndex","hasDropDownVisible","init","updateDropDownPosition","force","offsetLeft","update","hideDropDown","style","display","showDropDown","resetDropDownMenuHover","filterDropDownMenu","text","value","trim","visible","each","i","dropDownMenuItem","$dropDownMenuItem","show","data","indexOf","hide","clearFilterInput","updatePosition","input","closeDropDown","appendDropDownItem","optionElement","selected","appendItem","doTrigger","removeItem","remove","trigger","removeItemAndCloseDropDown","insertBefore","manageHover","isOn","click","preventDefault","stopPropagation","toggleItem","currentTarget","focus","mouseover","e","mouseout","keydownArrow","down","visibleNodeListArray","toArray","newIndex","forceUpdatePosition","width","Update","UpdateSizeImpl","UpdateReadonlyImpl","Dispose","removeData","off","destroy","document","unbind","UpdateReadonly","mousedown","mouseup","get","console","log","contains","val","insertAfter","placement","modifiers","preventOverflow","enabled","flip","ready","selectOptions","index","focusin","focusout","which","$penult","prev","$hoveredDropDownItem","dropDownItems","querySelectorAll","dropDownItem","it","textContent","toggle","jQueryInterface","test","optionsObject","methodName","charAt","toUpperCase","slice","Constructor","noConflict"],"mappings":"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"}